function transfer_file($file) {

    scp -i ~/$rsa_keyName "$file" "$rem_username@$rem_ip:/$rem_saveFolder/$m_cat"

    #Remove file after transfer if $remove_file is set
    Start-Sleep -s 1
    if ($remove_file -eq 1) {
        Write-Output "$file"
        #Remove-Item "$file"
    }
    
}

function convert_file() {

    #Argument Passed From For Loop
    $i=$1

    #GET FILE EXTENSION FROM FILE
    file_ext="${i##*.}"

    #GET FILE NAME FROM FILE
    file_name="${i%.*}"

    #If not a directory
    if [ ! -d "$i" ]; then

    # Search array for video ext
    if [[ " ${ext_array[@]} " =~ " ${file_ext} " ]]; then

    #Assign Video/Audio codecs to variables
    codecV=$(ffprobe -v error -select_streams v:0 -show_entries stream=codec_name -of default=nokey=1:noprint_wrappers=1 "$i")
    codecA=$(ffprobe -v error -select_streams a:0 -show_entries stream=codec_name -of default=nokey=1:noprint_wrappers=1 "$i")

    #IF H264 & MP4, transfer without conversion
    if [[ "$codecV" == "h264" ]] && [[ $file_ext == "mp4" ]]; then
    chmod 777 "$i"
                     
    mv "$i" "$m_saveFolder"

    #If transfer is enabled then transfer file
    if [ $enable_transfer -eq 1 ]; then
    transfer_file "$m_saveFolder/$i"
    fi

    #RECODE TO H264 & MP4
    else

    #Use ffmpeg to convert video, see https://ffmpeg.org/ffmpeg.html for alternate values
    ffmpeg -i "$i" -c:v libx264 -preset fast -crf 22 -c:a aac "${i%.*}.mp4"

    #Sleep until movie is processed !important
    while pidof /usr/bin/ffmpeg; do sleep 10; done >/dev/null

    chmod 777 "${i%.*}.mp4"
    mv "${i%.*}.mp4" "$m_saveFolder"
    rm "$i"

    #If transfer is enabled then transfer file
    if [ $enable_transfer -eq 1 ]; then
    transfer_file "$m_saveFolder/${i%.*}.mp4"
    fi
    fi

    elif [ $file_ext == "srt" ]; then
    mv "$i" "$m_saveFolder/$file_name.en.srt"

    if [ $enable_transfer -eq 1 ]; then
    transfer_file "$m_saveFolder/$file_name.en.srt"
    fi
    else
         
    rm "$i"
    fi
    fi
}